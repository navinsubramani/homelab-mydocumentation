# Table of Contents
- [Install LibreChat using docker compose](#install-librechat-using-docker-compose)
- [Troubleshooting](#troubleshooting)
  - [Debugging Permission Errors with Docker Volumes](#debugging-permission-errors-with-docker-volumes)
  - [Missing librechat.yaml File](#missing-librechatyaml-file)

# Install LibreChat using docker compose

The recommended way to install LibreChat is by using Docker Compose. This method simplifies the installation process and ensures that all necessary components are properly configured. The official LibreChat Docker Compose setup includes the LibreChat server, a database, and a reverse proxy for secure access, and this can be found here: https://github.com/danny-avila/LibreChat/blob/main/docker-compose.yml

I have modified the original docker-compose.yml file to support portainer deployement. I will try my best to keep this modified version up to date with the original one, but please refer to the original file for the latest updates, if any.

```yaml
# Do not edit this file directly. Use a ‘docker-compose.override.yaml’ file if you can.
# Refer to `docker-compose.override.yaml.example’ for some sample configurations.

services:
  api:
    container_name: LibreChat
    ports:
      - "${PORT}:${PORT}"
    depends_on:
      - mongodb
      - rag_api
    image: ghcr.io/danny-avila/librechat-dev:latest
    restart: always
    user: "${UID}:${GID}"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - HOST=0.0.0.0
      - MONGO_URI=mongodb://mongodb:27017/LibreChat
      - MEILI_HOST=http://meilisearch:7700
      - RAG_PORT=${RAG_PORT:-8000}
      - RAG_API_URL=http://rag_api:${RAG_PORT:-8000}
      - JWT_SECRET=${JWT_SECRET}
      - JWT_REFRESH_SECRET=${JWT_REFRESH_SECRET}
      - CREDS_KEY=${CREDS_KEY}
      - CREDS_IV=${CREDS_IV}
      - ALLOW_EMAIL_LOGIN=${ALLOW_EMAIL_LOGIN:-true}
      - ALLOW_REGISTRATION=${ALLOW_REGISTRATION:-true}
      - SEARCH=${SEARCH:-true}
      - MEILI_NO_ANALYTICS=${MEILI_NO_ANALYTICS:-true}
    env_file:
      - stack.env
    volumes:
      - /home/somedrive/LibreChat/librechat.yaml:/app/librechat.yaml
      - /home/somedrive/LibreChat/images:/app/client/public/images
      - /home/somedrive/LibreChat/uploads:/app/uploads
      - /home/somedrive/LibreChat/logs:/app/logs
  mongodb:
    container_name: chat-mongodb
    image: mongo:8.0.17
    restart: always
    user: "${UID}:${GID}"
    env_file:
      - stack.env
    volumes:
      - /home/somedrive/LibreChat/data-node:/data/db
    command: mongod --noauth
  meilisearch:
    container_name: chat-meilisearch
    image: getmeili/meilisearch:v1.12.3
    restart: always
    user: "${UID}:${GID}"
    environment:
      - MEILI_HOST=http://meilisearch:7700
      - MEILI_NO_ANALYTICS=true
      - MEILI_MASTER_KEY=${MEILI_MASTER_KEY}
    env_file:
      - stack.env
    volumes:
      - /home/somedrive/LibreChat/meili_data:/meili_data
  vectordb:
    container_name: vectordb
    image: pgvector/pgvector:0.8.0-pg15-trixie
    environment:
      POSTGRES_DB: mydatabase
      POSTGRES_USER: myuser
      POSTGRES_PASSWORD: mypassword
    restart: always
    volumes:
      - pgdata2:/var/lib/postgresql/data
  rag_api:
    container_name: rag_api
    image: ghcr.io/danny-avila/librechat-rag-api-dev-lite:latest
    environment:
      - DB_HOST=vectordb
      - RAG_PORT=${RAG_PORT:-8000}
    restart: always
    depends_on:
      - vectordb
    env_file:
      - stack.env

volumes:
  pgdata2:
```

For the above yaml file to work correctly, you need to create a `stack.env` file or set the environment variables in your Portainer stack settings. Here are the required environment variables:

```ini
PORT=3080
UID=1000
GID=1000
RAG_PORT=8000
MEILI_MASTER_KEY=
JWT_SECRET=
JWT_REFRESH_SECRET=
CREDS_KEY=
CREDS_IV=
ALLOW_EMAIL_LOGIN=true
ALLOW_REGISTRATION=true
ALLOW_UNVERIFIED_EMAIL_LOGIN=true
ANTHROPIC_API_KEY=user_provided
GOOGLE_KEY=user_provided
OPENAI_API_KEY=user_provided
ASSISTANTS_API_KEY=user_provided
SEARCH=true
MEILI_NO_ANALYTICS=true
MEILI_HOST=http://0.0.0.0:7700
DEBUG_LOGGING=true
```

after setting up the `docker-compose.yml` and `stack.env` files, you can deploy the stack using Portainer. Make sure to map the necessary volumes to persist data and configurations.

# Troubleshooting

## Debugging Permission Errors with Docker Volumes

The permission error is occurring because the mounted directories (/home/somedrive/LibreChat/logs, etc.) on your server don't have the correct ownership for UID 1000 and GID 1000.

You need to create these directories on your server and set the correct ownership. SSH into your server and run:

```bash
# Create the required directories
mkdir -p /home/somedrive/LibreChat/{logs,uploads,images,data-node,meili_data}

# Set ownership to UID 1000 and GID 1000
sudo chown -R 1000:1000 /home/somedrive/LibreChat/

# Set proper permissions
sudo chmod -R 755 /home/somedrive/LibreChat/
```

## Missing librechat.yaml File

The `librechat.yaml` file is a configuration file for LibreChat. If you don't have this file, you can create one based on your requirements. You can refer to the official example configuration here: https://github.com/danny-avila/LibreChat/blob/main/librechat.example.yaml

Copy the file to your desired location and modify it as needed.

```powerhell
scp D:\office\LibreChat\LibreChat\librechat.example.yaml username@xx:x:x:xxx:/home/somedrive/LibreChat/librechat.yaml
```

ensure that the `librechat.yaml` file is correctly mounted in your Docker container / server as shown in the docker-compose.yml file above.

```bash
sudo chown 1000:1000 /home/somedrive/LibreChat/librechat.yaml
```